<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</title>
    
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function(OneSignal) {
        await OneSignal.init({
          appId: "46c0fdfe-2b48-474f-b840-8b1a44c22d02",
          // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ù†Ø²Ù„Ù‚Ø© (Slidedown) Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ù†Ø§ÙØ°Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
          promptOptions: {
            slidedown: {
              prompts: [
                {
                  type: "push",
                  autoPrompt: false, // Ù„Ø§ ØªØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ø³Ù†Ø´ØºÙ„Ù‡Ø§ Ø¨Ø§Ù„Ø²Ø±
                  text: {
                    actionMessage: "Ù‡Ù„ ØªÙˆØ¯ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ ØªØ¨Ø±Ø¹Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©ØŸ",
                    acceptButton: "Ù†Ø¹Ù…ØŒ ÙØ¹Ù„Ù‡Ø§",
                    cancelButton: "Ù„Ø§ Ø´ÙƒØ±Ø§Ù‹"
                  }
                }
              ]
            }
          }
        });
      });
    </script>

    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background: #f4f4f4; }
        .btn {
            background: #e53935; color: white; padding: 15px 30px; 
            border: none; border-radius: 10px; font-size: 18px; width: 100%;
            margin-top: 20px; display: none;
        }
        .log-box {
            background: #333; color: #0f0; padding: 10px; 
            margin-top: 20px; text-align: left; font-size: 12px; 
            border-radius: 5px; min-height: 100px;
        }
    </style>
</head>
<body>

    <h3>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
    <button id="piLogin" class="btn" style="display:block; background:#fbc02d; color:black" onclick="login()">1. ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Pi</button>
    <button id="notifyBtn" class="btn" onclick="showSlidePrompt()">2. ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
    
    <div id="logs" class="log-box">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§...</div>

    <script>
        const Pi = window.Pi;
        Pi.init({ version: "2.0", sandbox: false });

        function log(txt) {
            document.getElementById('logs').innerHTML += `> ${txt}<br>`;
        }

        // ÙØ­Øµ Ø§Ù„Ø£Ù…Ø§Ù† ÙÙˆØ±Ø§Ù‹
        if (location.protocol !== 'https:') {
            log("âŒ Ø®Ø·Ø£: Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø¨Ù€ HTTPS. Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù† ØªØ¹Ù…Ù„!");
        } else {
            log("âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¢Ù…Ù† (HTTPS).");
        }

        async function login() {
            try {
                const scopes = ['username', 'payments'];
                const authResult = await Pi.authenticate(scopes, () => {});
                log("ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„: " + authResult.user.username);
                
                document.getElementById('piLogin').style.display = 'none';
                document.getElementById('notifyBtn').style.display = 'block';
                
                // Ø±Ø¨Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                window.OneSignalDeferred.push(function(OneSignal) {
                    OneSignal.login(authResult.user.uid);
                });
            } catch (e) { log("Ø®Ø·Ø£ Ø¯Ø®ÙˆÙ„: " + e); }
        }

        function showSlidePrompt() {
            log("Ø¬Ø§Ø±ÙŠ Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ù„Ø¨ (Slidedown)...");
            
            window.OneSignalDeferred.push(async function(OneSignal) {
                try {
                    // Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ§Ø¬Ù‡Ø© OneSignal Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­
                    await OneSignal.Slidedown.promptPush();
                    
                    log("ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ù†Ø§ÙØ°Ø©. Ù‡Ù„ Ø¸Ù‡Ø±ØªØŸ");
                    
                    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØºÙŠÙŠØ±
                    OneSignal.User.PushSubscription.addEventListener("change", function(event) {
                        if (event.current.optedIn) {
                            log("ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.");
                            document.getElementById('notifyBtn').innerText = "âœ… Ù…ÙØ¹Ù„Ø©";
                            document.getElementById('notifyBtn').disabled = true;
                        }
                    });

                } catch (e) {
                    log("Ø®Ø·Ø£ ÙÙŠ OneSignal: " + e);
                    // Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ù€ Slidedown Ù†Ø¬Ø±Ø¨ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© ÙƒØ§Ø­ØªÙŠØ§Ø·ÙŠ
                    OneSignal.User.PushSubscription.optIn();
                }
            });
        }
    </script>
</body>
</html>
