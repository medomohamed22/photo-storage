<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donate Way Notifications</title>
    
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>

    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function(OneSignal) {
        await OneSignal.init({
          appId: "46c0fdfe-2b48-474f-b840-8b1a44c22d02",
          
          // (Ø¥Ø¹Ø¯Ø§Ø¯ Ø¥Ø¶Ø§ÙÙŠ Ù…Ù‡Ù…) Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ù…Ø­Ù„ÙŠ
          allowLocalhostAsSecureOrigin: true, 
        });
      });
    </script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f3e5f5; /* Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­Ø© */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
        }
        .card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(103, 58, 183, 0.2);
            width: 90%;
            max-width: 400px;
        }
        h2 { color: #673ab7; margin-bottom: 10px; }
        p { color: #555; margin-bottom: 25px; }
        
        button {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        /* Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #piLoginBtn {
            background-color: #fbc02d;
            color: #333;
            box-shadow: 0 4px 10px rgba(251, 192, 45, 0.4);
        }
        #piLoginBtn:hover { background-color: #f9a825; }

        /* Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Ù…Ø®ÙÙŠ) */
        #notifyBtn {
            background-color: #ff5252;
            color: white;
            display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            box-shadow: 0 4px 10px rgba(255, 82, 82, 0.4);
            animation: popIn 0.5s ease;
        }
        #notifyBtn:hover { background-color: #ff1744; }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>

    <div class="card">
        <h2>Donate Way</h2>
        <p id="message">ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</p>

        <button id="piLoginBtn" onclick="loginPi()">âš¡ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Pi</button>
        <button id="notifyBtn" onclick="askNotificationPermission()">ğŸ”” ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¢Ù†</button>
    </div>

    <script>
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯ Pi Network
        const Pi = window.Pi;
        Pi.init({ version: "2.0", sandbox: true });

        // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function loginPi() {
            try {
                // Ø·Ù„Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
                const scopes = ['username', 'payments'];
                const authResult = await Pi.authenticate(scopes, onIncompletePaymentFound);
                
                // Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
                document.getElementById('message').innerHTML = `Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ <b>${authResult.user.username}</b><br>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª`;
                document.getElementById('piLoginBtn').style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„
                document.getElementById('notifyBtn').style.display = 'block'; // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª

                // (Ù…Ù‡Ù…) Ø±Ø¨Ø· Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Pi Ø¨Ù€ OneSignal
                // Ù‡Ø°Ø§ ÙŠØ¬Ø¹Ù„Ù†Ø§ Ù†Ø¹Ø±Ù Ù…Ù† ØµØ§Ø­Ø¨ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ø§Ø­Ù‚Ø§Ù‹
                window.OneSignalDeferred.push(function(OneSignal) {
                    OneSignal.login(authResult.user.uid);
                });

            } catch (error) {
                console.error(error);
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
            }
        }

        function onIncompletePaymentFound(payment) {
            console.log("Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù…Ø¹Ù„Ù‚Ø©:", payment);
        };

        // 2. Ø¯Ø§Ù„Ø© Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (ØªØ¹Ù…Ù„ Ø¹Ù†Ø¯ Ø¶ØºØ· Ø§Ù„Ø²Ø± Ø§Ù„Ø£Ø­Ù…Ø±)
        function askNotificationPermission() {
            window.OneSignalDeferred.push(async function(OneSignal) {
                // Ø£Ù…Ø± Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø³Ù…Ø§Ø­
                await OneSignal.User.PushSubscription.optIn();
                
                // ØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ·
                document.getElementById('notifyBtn').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙØ¹ÙŠÙ„...";
                setTimeout(() => {
                   document.getElementById('notifyBtn').innerText = "âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª";
                   document.getElementById('notifyBtn').disabled = true;
                   document.getElementById('notifyBtn').style.backgroundColor = "#4CAF50";
                }, 2000);
            });
        }
    </script>
</body>
</html>
