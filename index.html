<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi Notifications Test</title>
    
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>

    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 400px;
        }
        h2 { color: #673ab7; margin-bottom: 20px; } /* Ù„ÙˆÙ† Donate Way Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠ */
        
        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: transform 0.2s;
        }
        button:active { transform: scale(0.98); }

        #loginBtn {
            background-color: #fbc02d; /* Ù„ÙˆÙ† Ø¹Ù…Ù„Ø© Pi */
            color: #333;
            font-weight: bold;
        }

        #notifyBtn {
            background-color: #ff5252; /* Ù„ÙˆÙ† Ù…Ù…ÙŠØ² Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
            color: white;
            display: none; /* Ù…Ø®ÙÙŠ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        }

        #status {
            margin-top: 15px;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Pi App</h2>
        <p id="welcomeMsg">ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>

        <button id="loginBtn" onclick="loginWithPi()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Pi Network</button>

        <button id="notifyBtn" onclick="enableNotifications()">ğŸ”” ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>

        <p id="status"></p>
    </div>

    <script>
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Pi Network
        const Pi = window.Pi;
        Pi.init({ version: "2.0", sandbox: false }); // Ø§Ø¬Ø¹Ù„ sandbox: false Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ

        // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function loginWithPi() {
            try {
                const scopes = ['username', 'payments'];
                const authResult = await Pi.authenticate(scopes, onIncompletePaymentFound);
                
                // Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
                document.getElementById('welcomeMsg').innerText = "Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒØŒ " + authResult.user.username;
                document.getElementById('loginBtn').style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„
                document.getElementById('notifyBtn').style.display = 'block'; // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                document.getElementById('status').innerText = "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­.";

                // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù€ OneSignal Ù„Ø±Ø¨Ø· Ø§Ù„ÙŠÙˆØ²Ø± Ù†ÙŠÙ… Ø¨Ø§Ù„Ø¬Ù‡Ø§Ø²
                // OneSignal.login(authResult.user.uid); 

            } catch (error) {
                console.error(error);
                document.getElementById('status').innerText = "ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.";
            }
        }

        function onIncompletePaymentFound(payment) {
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© (Ù…Ø·Ù„ÙˆØ¨ Ù…Ù† Pi SDK)
            console.log("Incomplete payment found", payment);
        };

        // 2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª OneSignal (Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª)
        window.OneSignalDeferred = window.OneSignalDeferred || [];
        window.OneSignalDeferred.push(function(OneSignal) {
            OneSignal.init({
                appId: "Ø¶Ø¹-APP-ID-Ø§Ù„Ø®Ø§Øµ-Ø¨Ùƒ-Ù‡Ù†Ø§", // <--- Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø¨Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ù…ÙˆÙ‚Ø¹ OneSignal
                safari_web_id: "web.onesignal.auto.xxxxx", // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ù„Ø¢ÙŠÙÙˆÙ†)
                notifyButton: {
                    enable: false, // Ø³Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø®ØµØµ Ø§Ù„Ø®Ø§Øµ Ø¨Ù†Ø§
                },
                allowLocalhostAsSecureOrigin: true, // Ù„Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
            });
        });

        // Ø¯Ø§Ù„Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ Ø¶ØºØ· Ø§Ù„Ø²Ø±
        function enableNotifications() {
            window.OneSignalDeferred.push(function(OneSignal) {
                OneSignal.Slidedown.promptPush(); // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¬Ù…ÙŠÙ„Ø©
                
                // Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©:
                // OneSignal.User.PushSubscription.optIn();
            });
        }
    </script>
</body>
</html>
