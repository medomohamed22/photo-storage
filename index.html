<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Donate Way</title>
    
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f3e5f5;
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„ØµÙØ­Ø© */
        .main-content {
            text-align: center;
            color: #666;
        }
        .main-content h1 { color: #673ab7; }

        /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Popup) --- */
        
        /* 1. Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø¹ØªÙ…Ø© */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); /* ØªØ¹ØªÙŠÙ… Ø§Ù„Ø®Ù„ÙÙŠØ© */
            backdrop-filter: blur(5px); /* ØªØ£Ø«ÙŠØ± Ø¶Ø¨Ø§Ø¨ÙŠ */
            display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        /* 2. Ø¬Ø³Ù… Ø§Ù„Ù†Ø§ÙØ°Ø© */
        .modal-box {
            background: white;
            width: 85%;
            max-width: 350px;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            transform: scale(0.7);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¬Ø±Ø³ */
        .bell-anim {
            font-size: 50px;
            margin-bottom: 15px;
            display: inline-block;
            animation: ring 1.5s infinite ease-in-out;
        }

        /* Ø§Ù„Ù†ØµÙˆØµ */
        .modal-title {
            margin: 0 0 10px;
            color: #333;
            font-size: 20px;
            font-weight: bold;
        }
        .modal-desc {
            color: #666;
            font-size: 14px;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn {
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            flex: 1;
        }

        .btn-allow {
            background: #673ab7; /* Ø¨Ù†ÙØ³Ø¬ÙŠ */
            color: white;
            box-shadow: 0 4px 15px rgba(103, 58, 183, 0.4);
        }
        
        .btn-cancel {
            background: #eee;
            color: #555;
        }

        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø¸Ù‡ÙˆØ± */
        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }
        .modal-overlay.active .modal-box {
            transform: scale(1);
        }

        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø¬Ø±Ø³ */
        @keyframes ring {
            0% { transform: rotate(0); }
            10% { transform: rotate(15deg); }
            20% { transform: rotate(-15deg); }
            30% { transform: rotate(10deg); }
            40% { transform: rotate(-10deg); }
            100% { transform: rotate(0); }
        }

        #status-log { margin-top: 20px; font-size: 12px; color: green; }
    </style>
</head>
<body>

    <div class="main-content">
        <h1>Donate Way</h1>
        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…...</p>
        <div id="status-log"></div>
    </div>

    <div id="customModal" class="modal-overlay">
        <div class="modal-box">
            <div class="bell-anim">ğŸ””</div>
            <h3 class="modal-title">ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3>
            <p class="modal-desc">
                Ù‡Ù„ ØªÙˆØ¯ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ±ÙŠØ© Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ ØªØ¨Ø±Ø¹Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø£Ùˆ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨ÙƒØŸ
            </p>
            <div class="btn-group">
                <button class="btn btn-cancel" onclick="closeModal()">Ù„Ø§Ø­Ù‚Ø§Ù‹</button>
                <button class="btn btn-allow" onclick="subscribeUser()">Ù†Ø¹Ù…ØŒ ØªÙØ¹ÙŠÙ„</button>
            </div>
        </div>
    </div>

    <script>
        // 1. ØªÙ‡ÙŠØ¦Ø© Pi SDK
        const Pi = window.Pi;
        try {
            Pi.init({ version: "2.0", sandbox: false });
        } catch (e) { console.error(e); }

        // 2. Ø¥Ø¹Ø¯Ø§Ø¯ OneSignal ÙˆØ§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø©
        window.OneSignalDeferred = window.OneSignalDeferred || [];
        
        OneSignalDeferred.push(async function(OneSignal) {
            await OneSignal.init({
                appId: "46c0fdfe-2b48-474f-b840-8b1a44c22d02",
                allowLocalhostAsSecureOrigin: true,
            });

            // Ø§Ù„ØªØ­Ù‚Ù‚: Ù‡Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø´ØªØ±Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ
            if (OneSignal.User.PushSubscription.optedIn) {
                document.getElementById('status-log').innerText = "âœ… Ø£Ù†Øª Ù…Ø´ØªØ±Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª";
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø´ØªØ±ÙƒØ§Ù‹ -> Ø£Ø¸Ù‡Ø± Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ© ÙˆÙ†ØµÙ
                setTimeout(() => {
                    openModal();
                }, 1500);
            }
        });

        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© (Open/Close)
        function openModal() {
            document.getElementById('customModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('customModal').classList.remove('active');
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ù†Ø¹Ù…"
        function subscribeUser() {
            const allowBtn = document.querySelector('.btn-allow');
            allowBtn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙØ¹ÙŠÙ„...";
            
            window.OneSignalDeferred.push(async function(OneSignal) {
                try {
                    // Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù†
                    await OneSignal.User.PushSubscription.optIn();
                    
                    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„
                    setTimeout(() => {
                        closeModal();
                        document.getElementById('status-log').innerText = "ğŸ‰ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!";
                    }, 2000); // Ù†Ù†ØªØ¸Ø± Ø«Ø§Ù†ÙŠØªÙŠÙ† Ù„Ù†Ø±ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†ØªÙŠØ¬Ø©

                } catch (error) {
                    allowBtn.innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£";
                    alert("ØªØ¹Ø°Ø± Ø§Ù„ØªÙØ¹ÙŠÙ„. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­.");
                }
            });
        }
    </script>
</body>
</html>
